<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Proxmox硬碟更換及擴容 | Louis Li&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="在這篇文章中，我們將探討如何在Proxmox上將舊的2TB SSD硬碟升級至4TB，並無需重新安裝系統或移動虛擬機的操作步驟和方法。">
    <meta name="og:title" content="Proxmox硬碟更換及擴容">
    <meta name="og:description" content="在這篇文章中，我們將探討如何在Proxmox上將舊的2TB SSD硬碟升級至4TB，並無需重新安裝系統或移動虛擬機的操作步驟和方法。">
    <meta name="og:image" content="/img/og_image.png">
    <meta name="keywords" content="個人技術部落格,網路,Kubernetes,Linux">
    <meta name="theme-color" content="#11a8cd">
    <meta name="charset" content="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.2ebaa67f.css" as="style"><link rel="preload" href="/assets/js/app.cb16ecd0.js" as="script"><link rel="preload" href="/assets/js/2.2b01b354.js" as="script"><link rel="preload" href="/assets/js/26.e40f46b7.js" as="script"><link rel="prefetch" href="/assets/js/10.bbf6869c.js"><link rel="prefetch" href="/assets/js/11.5af1f204.js"><link rel="prefetch" href="/assets/js/12.7dbcb6d5.js"><link rel="prefetch" href="/assets/js/13.02b26798.js"><link rel="prefetch" href="/assets/js/14.4fd9b6ba.js"><link rel="prefetch" href="/assets/js/15.02b32814.js"><link rel="prefetch" href="/assets/js/16.356e6b3a.js"><link rel="prefetch" href="/assets/js/17.53c69df4.js"><link rel="prefetch" href="/assets/js/18.a472fde3.js"><link rel="prefetch" href="/assets/js/19.eb7eb15a.js"><link rel="prefetch" href="/assets/js/20.f6da8ff4.js"><link rel="prefetch" href="/assets/js/21.7d208469.js"><link rel="prefetch" href="/assets/js/22.a00a1a38.js"><link rel="prefetch" href="/assets/js/23.5aeb2578.js"><link rel="prefetch" href="/assets/js/24.0b90cd8d.js"><link rel="prefetch" href="/assets/js/25.58482239.js"><link rel="prefetch" href="/assets/js/27.b3b48379.js"><link rel="prefetch" href="/assets/js/28.de68677f.js"><link rel="prefetch" href="/assets/js/29.3384551f.js"><link rel="prefetch" href="/assets/js/3.62d7cadb.js"><link rel="prefetch" href="/assets/js/30.fb6e4035.js"><link rel="prefetch" href="/assets/js/4.5de74737.js"><link rel="prefetch" href="/assets/js/5.81cf5ff3.js"><link rel="prefetch" href="/assets/js/6.f3f930b8.js"><link rel="prefetch" href="/assets/js/7.2b011f1d.js"><link rel="prefetch" href="/assets/js/8.e1609e82.js"><link rel="prefetch" href="/assets/js/9.62355ca7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2ebaa67f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目錄" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo512.png" alt="Louis Li's Blog" class="logo"> <span class="site-name can-hide">Louis Li's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首頁</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分類</a></div><div class="nav-item"><a href="/tags/" class="nav-link">標籤</a></div><div class="nav-item"><a href="/archives/" class="nav-link">Archives</a></div> <a href="https://github.com/gamerslouis/gamerslouis.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpg"> <div class="blogger-info"><h3>Louis Li</h3> <span>努力畢業的菸酒生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首頁</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分類</a></div><div class="nav-item"><a href="/tags/" class="nav-link">標籤</a></div><div class="nav-item"><a href="/archives/" class="nav-link">Archives</a></div> <a href="https://github.com/gamerslouis/gamerslouis.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Proxmox硬碟更換及擴容</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/proxmox-hard-disk-replacement-and-expansion/#硬碟內容搬遷" class="sidebar-link">硬碟內容搬遷</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/proxmox-hard-disk-replacement-and-expansion/#調整硬碟分割區大小" class="sidebar-link">調整硬碟分割區大小</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/proxmox-hard-disk-replacement-and-expansion/#調整-lvm" class="sidebar-link">調整 LVM</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-12a44dd8><div class="articleInfo" data-v-12a44dd8><!----> <div class="info" data-v-12a44dd8><div title="作者" class="author iconfont icon-touxiang" data-v-12a44dd8><a href="https://github.com/gamerslouis" target="_blank" title="作者" class="beLink" data-v-12a44dd8>Louis</a></div> <div title="創建時間" class="date iconfont icon-riqi" data-v-12a44dd8><a href="javascript:;" data-v-12a44dd8>2023-08-03</a></div> <div title="分類" class="date iconfont icon-wenjian" data-v-12a44dd8><a href="/categories/?category=%E7%B6%B2%E7%AE%A1%E6%97%A5%E5%B8%B8" data-v-12a44dd8>網管日常 </a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目錄</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Proxmox硬碟更換及擴容<!----></h1>  <div class="theme-vdoing-content content__default"><p>在手邊的 Proxmox 上使用了一年多的時間，最初是使用一顆 2TB 的 SSD 硬碟，但隨著時間推移，硬碟的容量已經不足以應付需求。為了解決這個問題，決定購買一顆 4TB 的 SSD 來替換。然而，為了節省時間和方便起見，希望能夠直接將舊硬碟的內容遷移到新硬碟上，而不必重新安裝 Proxmox 系統，也不需要搬遷虛擬機。因此，進行了一些研究和操作來實現這個目標，這裡記錄下相關的步驟和方法。</p> <h2 id="硬碟內容搬遷"><a href="#硬碟內容搬遷" class="header-anchor">#</a> <strong>硬碟內容搬遷</strong></h2> <p>首先，我們需要將原始硬碟內的資料搬移到新的硬碟上。我們可以使用 <strong><code>dd</code></strong> 命令直接將硬碟內容完全複製過去。這可以在 Proxmox 的 Shell 中執行，無需使用額外的 USB 開機碟操作。儘管這樣做可能會複製 swap 等內容，但重開機後不會影響系統運作。</p> <p>請先使用 <strong><code>lsblk</code></strong> 命令找到原始硬碟和目標硬碟：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lsblk</span>
NAME                          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1                       <span class="token number">259</span>:0    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> disk
├─nvme0n1p1                   <span class="token number">259</span>:1    <span class="token number">0</span> 1007K  <span class="token number">0</span> part
├─nvme0n1p2                   <span class="token number">259</span>:2    <span class="token number">0</span>  512M  <span class="token number">0</span> part /boot/efi
└─nvme0n1p3                   <span class="token number">259</span>:3    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> part
  ├─pve-swap                  <span class="token number">253</span>:0    <span class="token number">0</span>    8G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  ├─pve-root                  <span class="token number">253</span>:1    <span class="token number">0</span>   96G  <span class="token number">0</span> lvm  /
  ├─pve-data_tmeta            <span class="token number">253</span>:2    <span class="token number">0</span> <span class="token number">15</span>.8G  <span class="token number">0</span> lvm
  │ └─pve-data-tpool          <span class="token number">253</span>:4    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> lvm
  │   ├─pve-data              <span class="token number">253</span>:5    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">1</span> lvm
  │   ├─pve-vm--100--disk--0  <span class="token number">253</span>:6    <span class="token number">0</span>    1T  <span class="token number">0</span> lvm
  <span class="token punctuation">..</span><span class="token punctuation">..</span>
nvme1n1                       <span class="token number">259</span>:4    <span class="token number">0</span>  <span class="token number">3</span>.6T  <span class="token number">0</span> disk
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>從上述輸出中，我們可以很容易地辨識出 <strong><code>nvme0n1</code></strong> 為原始硬碟，<strong><code>nvme1n1</code></strong> 為新的硬碟。</p> <p>接下來，使用 <strong><code>dd</code></strong> 命令進行硬碟內容的複製。為了在處理過程中顯示進度，我們加上 <strong><code>status=progress</code></strong> 選項。這樣在複製 2TB 資料時，我們可以知道進度，而不會等太久不知道是不是當掉了 (搬了超過半小時)。<strong><code>bs</code></strong> 參數代表 <strong><code>dd</code></strong> 一次搬動的資料塊大小，預設值是 512bytes，但這可能會導致速度變慢，因此我們可以選擇較大的值，例如 <strong><code>bs=2G</code></strong>。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># dd if=/dev/nvme0n1 of=/dev/nvme1n1 status=progress bs=2G</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>完成後，關機並將舊的硬碟移除，用新的硬碟開機。</p> <h2 id="調整硬碟分割區大小"><a href="#調整硬碟分割區大小" class="header-anchor">#</a> 調整硬碟分割區大小</h2> <p>理論上，重開機後，應該可以正常進入系統，但從 Proxmox 的 Web GUI 可能會發現存儲空間的大小沒有變化。這是因為雖然資料已經完全複製到容量更大的硬碟，但系統設定仍然只認識原本的硬碟大小。因此，接下來我們需要調整分割區和 LVM 的配置，讓 Proxmox 能夠使用新的空間。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lsblk</span>
NAME                          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1                       <span class="token number">259</span>:0    <span class="token number">0</span>  <span class="token number">3</span>.6T  <span class="token number">0</span> disk
├─nvme0n1p1                   <span class="token number">259</span>:1    <span class="token number">0</span> 1007K  <span class="token number">0</span> part
├─nvme0n1p2                   <span class="token number">259</span>:2    <span class="token number">0</span>  512M  <span class="token number">0</span> part /boot/efi
└─nvme0n1p3                   <span class="token number">259</span>:3    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> part
  ├─pve-swap                  <span class="token number">253</span>:0    <span class="token number">0</span>    8G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  ├─pve-root                  <span class="token number">253</span>:1    <span class="token number">0</span>   96G  <span class="token number">0</span> lvm  /
  ├─pve-data_tmeta            <span class="token number">253</span>:2    <span class="token number">0</span> <span class="token number">15</span>.8G  <span class="token number">0</span> lvm
  │ └─pve-data-tpool          <span class="token number">253</span>:4    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> lvm
  │   ├─pve-data              <span class="token number">253</span>:5    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">1</span> lvm
  │   ├─pve-vm--100--disk--0  <span class="token number">253</span>:6    <span class="token number">0</span>    1T  <span class="token number">0</span> lvm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>透過  <code>lsblk</code> ，可以看到硬碟的大小為 3.6T。由於 pve 的資料都放在 nvem0n1p3 這個分割區下面，所以我們要先調整分割區的大小。</p> <p>這邊我們使用  <code>growpart</code>  這個工具來調整分割區大小。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">apt</span> <span class="token function">install</span> cloud-guest-utils
growpart /dev/nvme0n1 <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong><code>growpart</code></strong> 的第一個參數是要調整的硬碟，第二個參數是第幾個分割區。<strong><code>growpart</code></strong> 預設會將硬碟的剩餘未分配空間都分配給分割區，因此不需要指定大小。如果你擔心出問題，可以先加上 <strong><code>-N</code></strong> 選項查看分配的結果是否符合預期。</p> <p>分配完成後，再次使用 <strong><code>lsblk</code></strong> 命令來確認。現在，<strong><code>nvme0n1p3</code></strong> 分割區的大小應該已經變成 3.6T 了：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lsblk</span>
NAME                          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1                       <span class="token number">259</span>:0    <span class="token number">0</span>  <span class="token number">3</span>.6T  <span class="token number">0</span> disk
├─nvme0n1p1                   <span class="token number">259</span>:1    <span class="token number">0</span> 1007K  <span class="token number">0</span> part
├─nvme0n1p2                   <span class="token number">259</span>:2    <span class="token number">0</span>  512M  <span class="token number">0</span> part /boot/efi
└─nvme0n1p3                   <span class="token number">259</span>:3    <span class="token number">0</span>  <span class="token number">3</span>.6T  <span class="token number">0</span> part
  ├─pve-swap                  <span class="token number">253</span>:0    <span class="token number">0</span>    8G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
  ├─pve-root                  <span class="token number">253</span>:1    <span class="token number">0</span>   96G  <span class="token number">0</span> lvm  /
  ├─pve-data_tmeta            <span class="token number">253</span>:2    <span class="token number">0</span> <span class="token number">15</span>.8G  <span class="token number">0</span> lvm
  │ └─pve-data-tpool          <span class="token number">253</span>:4    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">0</span> lvm
  │   ├─pve-data              <span class="token number">253</span>:5    <span class="token number">0</span>  <span class="token number">1</span>.7T  <span class="token number">1</span> lvm
  │   ├─pve-vm--100--disk--0  <span class="token number">253</span>:6    <span class="token number">0</span>    1T  <span class="token number">0</span> lvm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>但是從 Proxmox 的 Web GUI，你可能會發現存儲空間大小還是沒有改變。這是因為 Proxmox 在 partition 上透過 LVM 做了一層分割，所以我們需要調整 LVM 的大小。</p> <h2 id="調整-lvm"><a href="#調整-lvm" class="header-anchor">#</a> 調整 LVM</h2> <p>首先，我們要調整硬碟分割區對應的 PV（物理卷）大小：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># pvs</span>
PV             VG  Fmt  Attr PSize  PFree
/dev/nvme0n1p3 pve lvm2 a--  <span class="token operator">&lt;</span><span class="token number">1</span>.74t <span class="token operator">&lt;</span><span class="token number">0</span>.2t
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用 <strong><code>pvs</code></strong> 命令可以查看 PV 的資訊。</p> <p>接下來，使用 <strong><code>pvresize</code></strong> 命令將分割區剩餘的所有空間都加入到 PV 內：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>pvresize /dev/nvme0n1p3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>這樣就能將分割區未使用的空間加入到 PV，無需進行其他配置。</p> <p>再次執行 <strong><code>pvs</code></strong> 命令，現在你應該會看到 PV 的大小已經增加了：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># pvs</span>
PV             VG  Fmt  Attr PSize  PFree
/dev/nvme0n1p3 pve lvm2 a--  <span class="token operator">&lt;</span><span class="token number">3</span>.64t <span class="token operator">&lt;</span><span class="token number">1</span>.84t
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最後，我們需要調整 storage 對應的 LV（邏輯卷）的大小。首先，使用 <strong><code>lvs</code></strong> 命令來查看 LV 的資訊</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lvs</span>
LV             VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
data           pve twi-aotz--   <span class="token number">1</span>.67t             <span class="token number">73.80</span>  <span class="token number">3.82</span>
root           pve -wi-ao----  <span class="token number">96</span>.00g
swap           pve -wi-ao----   <span class="token number">8</span>.00g
vm-100-disk-0  pve Vwi-aotz--   <span class="token number">1</span>.00t data        <span class="token number">57.73</span>
vm-100-disk-1  pve Vwi-aotz--   <span class="token number">4</span>.00m data        <span class="token number">14.06</span>
vm-101-disk-0  pve Vwi-a-tz-- <span class="token number">100</span>.00g data        <span class="token number">71.78</span>
vm-102-disk-0  pve Vwi-aotz--   <span class="token number">4</span>.00m data        <span class="token number">14.06</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>從上述輸出中，可以看到所有 VM 的硬碟都掛載在 <strong><code>pve/data</code></strong> 這個 pool 下面。因此，我們需要調整的是 <strong><code>pve/data</code></strong> 的大小。</p> <p>使用 <strong><code>lvresize</code></strong> 命令來調整 LV 分配的空間， <strong><code>-l</code></strong> 表示擴大， <strong><code>+100%FREE</code></strong> 表示將所有閒置空間分配給該 LV，最後指定 <strong><code>pve/data</code></strong>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>lvresize <span class="token parameter variable">-l</span> +100%FREE pve/data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>執行完後再次使用 <strong><code>lvs</code></strong> 命令確認，現在 <strong><code>data</code></strong> 的大小應該已經變大了：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># lvs</span>
lvs
LV             VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
data           pve twi-aotz--  <span class="token operator">&lt;</span><span class="token number">3</span>.51t             <span class="token number">35.16</span>  <span class="token number">3.86</span>
root           pve -wi-ao----  <span class="token number">96</span>.00g
swap           pve -wi-ao----   <span class="token number">8</span>.00g
vm-100-disk-0  pve Vwi-aotz--   <span class="token number">1</span>.00t data        <span class="token number">57.73</span>
vm-100-disk-1  pve Vwi-aotz--   <span class="token number">4</span>.00m data        <span class="token number">14.06</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>現在，從 Proxmox Web GUI，你也應該可以看到存儲空間大小已成功調整。</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Proxmox" title="標簽">#Proxmox</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/29</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/posts/Openstack-Deployment-Serial-3-Basic-Management-Commands/"><div>
            OpenStack 架設系列文章 (3) - 基本指令操作
            <!----></div></a> <span class="date">11-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/posts/Solve-Openstack-vm-create-fail/"><div>
            解決 OpenStack  VM 建立失敗問題
            <!----></div></a> <span class="date">11-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/posts/Install-openvpn-client-on-proxmox/"><div>
            Proxmox 安裝 OpenVPN client 紀錄
            <!----></div></a> <span class="date">11-01</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:me@louisif.me" title="Email" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/gamerslouis" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主題">Vdoing</a> 
    | Copyright © 2022-2024
    <span>Louis Li</span></div> <div class="buttons"><div title="返回頂部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去評論" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主題模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟隨係統
        </li><li class="iconfont icon-rijianmoshi">
          淺色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.cb16ecd0.js" defer></script><script src="/assets/js/2.2b01b354.js" defer></script><script src="/assets/js/26.e40f46b7.js" defer></script>
  </body>
</html>
